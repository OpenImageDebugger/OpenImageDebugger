language: cpp

matrix:
 include:
  - os: osx
    osx_image: xcode12.5

  - os: linux
    dist: bionic
    
  - os: linux
    dist: focal

addons:
  homebrew:
    packages:
      - qt5
    update: false
  apt:
    packages:
      - qt5-default
      - libqt5opengl5-dev
      - python2.7-dev
      - python3-dev
      - pkg-config
    update: true

before_install:
  # Allow qmake to be called via CLI on MacOS
  # See https://github.com/Homebrew/legacy-homebrew/issues/29938
  - if [ $TRAVIS_OS_NAME = osx ]; then brew link qt5 --force && export PATH=/usr/local/opt/qt5/bin:$PATH; fi

script:
  - mkdir build && cd build
  - if: os = osx
    qmake .. PREFIX=/tmp
    else: cmake .. -DCMAKE_BUILD_TYPE=release -DCMAKE_INSTALL_PREFIX=/tmp
  - make -j8
  - make install
